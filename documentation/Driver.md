# Пакет driver

Пакет **`driver`** — это центральный узел модуля Selenium. Он отвечает за инициализацию драйвера, управление его
жизненным циклом (создание/закрытие) и предоставление единого API для взаимодействия с ним.

Основные компоненты:

1. **Фабрика (`SeleniumDriverAdapterFactory`):** Точка входа в модуль.
2. **Менеджер сессии (`DriverManager`):** Потокобезопасное хранилище экземпляра WebDriver.
3. **Адаптер (`SeleniumDriverAdapter`):** Реализация контракта `DriverAdapter`, делегирующая команды Selenium.

---

## 1. Класс `SeleniumDriverAdapter`

Основной класс модуля. Является реализацией интерфейса `DriverAdapter` (из `core_lib`).
Этот класс не выполняет действия сам, а служит фасадом (Composite), который распределяет (делегирует) задачи между
специализированными мини-адаптерами (`MouseAdapter`, `TextAdapter` и т.д.).

### Поля класса

| Поле                    | Тип                           | Описание                                                       |
|:------------------------|:------------------------------|:---------------------------------------------------------------|
| **`driver`**            | `WebDriver`                   | Экземпляр драйвера Selenium. Используется для закрытия сессии. |
| **`mouseAdapter`**      | `SeleniumMouseAdapter`        | Делегат для кликов мыши.                                       |
| **`navigationAdapter`** | `SeleniumNavigationAdapter`   | Делегат для навигации по URL.                                  |
| **`textAdapter`**       | `SeleniumTextAdapter`         | Делегат для получения текста элементов.                        |
| **`stateAdapter`**      | `SeleniumElementStateAdapter` | Делегат для проверки состояния элементов (виден/скрыт).        |

### Конструктор

| Конструктор                                   | Логика работы                                                                                                                                                                                 |
|:----------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`SeleniumDriverAdapter(WebDriver driver)`** | 1. Проверяет, что переданный драйвер не `null`.<br>2. Получает `PageHolder` из контекста ядра.<br>3. Инициализирует все дочерние адаптеры, передавая им экземпляр драйвера и холдер страницы. |

### Методы (Реализация API)

Все методы этого класса являются проксирующими: они просто перенаправляют вызов в соответствующий внутренний адаптер.

| Метод                                                      | Делегат             | Описание                                                                                           |
|:-----------------------------------------------------------|:--------------------|:---------------------------------------------------------------------------------------------------|
| **`clickElement`**, **`doubleClick`**, **`rightClick`**    | `mouseAdapter`      | Действия мыши.                                                                                     |
| **`openURL`**                                              | `navigationAdapter` | Открытие страницы.                                                                                 |
| **`getTextFromElement`**                                   | `textAdapter`       | Получение текста.                                                                                  |
| **`isElementDisplayed`**, **`isPresent`**, **`isEnabled`** | `stateAdapter`      | Проверка состояния.                                                                                |
| **`close`**                                                | -                   | **Прямой вызов:** Вызывает `driver.quit()`. Завершает процесс браузера и очищает ресурсы Selenium. |

---

## 2. Класс `SeleniumDriverAdapterFactory`

Реализация интерфейса `DriverAdapterFactory`. Этот класс является точкой входа для `core_lib`, позволяя загружать
Selenium модуль динамически.

**Регистрация:** Класс прописан в `META-INF/services/driverAdapter.DriverAdapterFactory`.

### Методы

| Метод               | Логика                                                                                                                                                                                                                                                                                                                                                 |
|:--------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`getEngineName`** | Возвращает строку `"selenium"`. Это идентификатор движка для конфига `runtime.yaml`.                                                                                                                                                                                                                                                                   |
| **`create`**        | **Фабричный метод.**<br>1. Создает экземпляр `SeleniumBrowserCapabilities` (диспетчер браузеров).<br>2. Вызывает `createDriver()`, чтобы получить готовый `WebDriver` (Chrome/Firefox/Edge).<br>3. Регистрирует созданный драйвер в `DriverManager` (для глобального доступа).<br>4. Возвращает новый `SeleniumDriverAdapter`, обернув в него драйвер. |

---

## 3. Класс `DriverManager`

Класс для управления контекстом `WebDriver`. Реализует паттерн **Thread-Local Storage**, обеспечивая изоляцию браузерных
сессий при параллельном запуске тестов.

**Назначение:** Позволяет получить доступ к "сырому" объекту `WebDriver` из любой точки кода (даже если у вас нет ссылки
на адаптер), что полезно для низкоуровневых хаков или интеграций со сторонними библиотеками (например, Selenide или
Reporting tools).

### Поля

| Поле         | Тип                      | Описание                                                            |
|:-------------|:-------------------------|:--------------------------------------------------------------------|
| **`driver`** | `ThreadLocal<WebDriver>` | Контейнер, хранящий экземпляр драйвера отдельно для каждого потока. |

### Методы

| Метод                                      | Описание и Логика                                                                                                                                                                                                           |
|:-------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`setDriver`**<br>(`WebDriver webDriver`) | Сохраняет экземпляр драйвера в контекст текущего потока. Вызывается фабрикой при создании.                                                                                                                                  |
| **`getDriver`**                            | Возвращает драйвер текущего потока. Может вернуть `null`, если драйвер не был создан.                                                                                                                                       |
| **`quitDriver`**                           | Безопасное завершение сессии.<br>1. Проверяет, существует ли драйвер (`get() != null`).<br>2. Вызывает `driver.quit()` (закрывает окно).<br>3. Вызывает `driver.remove()` (очищает ThreadLocal во избежание утечек памяти). |

---

## 4. Интерфейс `BrowserDriverFactory`

Специфичный для Selenium контракт фабрики браузеров. Расширяет универсальный интерфейс `BrowserFactory<T>` из ядра,
уточняя тип `T` -> `WebDriver`.

**Назначение:** Позволяет создавать полиморфные фабрики для конкретных браузеров (`ChromeFactory`, `FirefoxFactory`),
которые возвращают именно `WebDriver`.

### Методы

| Метод                | Описание                                                                               |
|:---------------------|:---------------------------------------------------------------------------------------|
| **`getBrowserName`** | Возвращает имя браузера (chrome, firefox).                                             |
| **`createDriver`**   | Принимает конфиг `BrowserConfig` и возвращает готовый, инициализированный `WebDriver`. |